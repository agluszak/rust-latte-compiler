---
source: tests/generated_from_inputs.rs
description: "int x() {\n    return -37;\n}\n\nstring y() {\n    return \"foo\";\n}\n\nstring z() {\n    return \"bar\";\n}\n\nint main() {\n  printInt(x()-5);\n  printString(y()+z());\n  return 0 ;\n}"
---
; ModuleID = 'core018_fun'
source_filename = "core018_fun"

%string = type { ptr, i32, i32 }

declare void @memcpy(ptr, ptr, i32)

declare void @printInt(i32)

declare void @printString(ptr)

declare i32 @readInt()

declare ptr @readString()

declare void @error()

define i32 @main() {
b0:
  %x = call i32 @x()
  %v2 = sub i32 %x, 5
  call void @printInt(i32 %v2)
  %y = call ptr @y()
  %z = call ptr @z()
  %buf_ptr = getelementptr inbounds %string, ptr %y, i32 0, i32 0
  %len_ptr = getelementptr inbounds %string, ptr %y, i32 0, i32 1
  %buf_ptr1 = getelementptr inbounds %string, ptr %z, i32 0, i32 0
  %len_ptr2 = getelementptr inbounds %string, ptr %z, i32 0, i32 1
  %buf = load ptr, ptr %buf_ptr, align 8
  %len = load i32, ptr %len_ptr, align 4
  %buf3 = load ptr, ptr %buf_ptr1, align 8
  %len4 = load i32, ptr %len_ptr2, align 4
  %new_len = add i32 %len, %len4
  %mallocsize = mul i32 %new_len, ptrtoint (ptr getelementptr (i8, ptr null, i32 1) to i32)
  %new_buf = tail call ptr @malloc(i32 %mallocsize)
  %new_string = tail call ptr @malloc(i32 ptrtoint (ptr getelementptr (%string, ptr null, i32 1) to i32))
  call void @memcpy(ptr %new_buf, ptr %buf, i32 %len)
  %new_buf_second_part = getelementptr i8, ptr %new_buf, i32 %len
  call void @memcpy(ptr %new_buf_second_part, ptr %buf3, i32 %len4)
  %buf_ptr5 = getelementptr inbounds %string, ptr %new_string, i32 0, i32 0
  %len_ptr6 = getelementptr inbounds %string, ptr %new_string, i32 0, i32 1
  %cap_ptr = getelementptr inbounds %string, ptr %new_string, i32 0, i32 2
  store ptr %new_buf, ptr %buf_ptr5, align 8
  store i32 %new_len, ptr %len_ptr6, align 4
  store i32 %new_len, ptr %cap_ptr, align 4
  call void @printString(ptr %new_string)
  ret i32 0
}

define i32 @x() {
b0:
  ret i32 -37
}

define ptr @y() {
b0:
  %buf = tail call ptr @malloc(i32 mul (i32 ptrtoint (ptr getelementptr (i8, ptr null, i32 1) to i32), i32 3))
  store [3 x i8] c"foo", ptr %buf, align 1
  %string = tail call ptr @malloc(i32 ptrtoint (ptr getelementptr (%string, ptr null, i32 1) to i32))
  %buf_ptr = getelementptr inbounds %string, ptr %string, i32 0, i32 0
  %len_ptr = getelementptr inbounds %string, ptr %string, i32 0, i32 1
  %len_ptr1 = getelementptr inbounds %string, ptr %string, i32 0, i32 2
  store ptr %buf, ptr %buf_ptr, align 8
  store i32 3, ptr %len_ptr, align 4
  store i32 3, ptr %len_ptr1, align 4
  ret ptr %string
}

define ptr @z() {
b0:
  %buf = tail call ptr @malloc(i32 mul (i32 ptrtoint (ptr getelementptr (i8, ptr null, i32 1) to i32), i32 3))
  store [3 x i8] c"bar", ptr %buf, align 1
  %string = tail call ptr @malloc(i32 ptrtoint (ptr getelementptr (%string, ptr null, i32 1) to i32))
  %buf_ptr = getelementptr inbounds %string, ptr %string, i32 0, i32 0
  %len_ptr = getelementptr inbounds %string, ptr %string, i32 0, i32 1
  %len_ptr1 = getelementptr inbounds %string, ptr %string, i32 0, i32 2
  store ptr %buf, ptr %buf_ptr, align 8
  store i32 3, ptr %len_ptr, align 4
  store i32 3, ptr %len_ptr1, align 4
  ret ptr %string
}

declare noalias ptr @malloc(i32)

